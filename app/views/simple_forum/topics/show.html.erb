<h1><%= @topic.title %></h1>

<table>
  <% for post in @posts do -%>
      <tr id="<%= "post-#{post.id}" %>">
        <td>
          <span class="name">
            <strong><%= post.user.login %></strong>
          </span>
          <br/>
          <span class="postdetails">
            Dołączył:
            <%= l post.user.created_at.to_date %>
            <br/>
            <% if post.user.respond_to?(:forum_posts_count) %>
              Posts:
                <%= number_with_delimiter post.user.forum_posts_count %>
            <% end %>
          </span>
        </td>
        <td>
          <span style="display: none;"><a name="<%= post.id %>"></a></span>
          <table>
            <tr>
              <td>
                <%= t 'simple_forum.post_age', :ago => time_ago_in_words(post.created_at), :at => l(post.created_at), :default => "Sent: %{at} / %{ago} ago" %>
              </td>
              <td>
                <% if user_authenticated? %>
                    <% if post.editable_by?(authenticated_user, @forum.moderated_by?(authenticated_user)) %>
                        <%= link_to t('.edit'), edit_simple_forum_forum_topic_post_path(@forum, @topic, post) %>
                    <% end %>
                    <% if post.deletable_by?(authenticated_user, @forum.moderated_by?(authenticated_user)) %>
                        <%= link_to t('.delete'), delete_simple_forum_forum_topic_post_path(@forum, @topic, post), :method => :delete, :confirm => "Are you sure?" %>
                    <% end %>
                    <% if @topic.is_open? %>
                        <%= link_to "Cite", "#", :onclick => "$('#new_post_form textarea').val('[quote=\"#{post.user.login}\"]\\n#{escape_javascript(post.body)}\\n[/quote]'); return false;" %>
                    <% end %>
                <% end %>
              </td>
            </tr>
            <tr>
              <td colspan="2">
                <div class="postbody">
                  <% if post.is_deleted? %>
                      <%= t('.post_deleted') %>
                      <% if post.deleted_by %>
                          <%= t('.by') %>
                          <%= post.deleted_by.login %>
                      <% end %>
                      <%= t('.at') %>
                      <%= l post.deleted_at %>
                  <% else %>
                      <%= post.output %>
                  <% end %>
                </div>
                <% if !post.is_deleted? && post.is_edited? %>
                    <span>
                      <%= t('.post_edited') %>
                      <% if post.edited_by %>
                          <%= t('.by') %>
                          <%= post.edited_by.login %>
                      <% end %>
                      <%= t('.at') %>
                      <%= l post.edited_at %>
                    </span>
                <% end %>
              </td>
            </tr>
          </table>
        </td>
      </tr>
  <% end %>
</table>

<%= will_paginate @posts if respond_to?(:will_paginate) %>

<% if @topic.is_open? %>
    <% if user_authenticated? %>
        <%= form_for @post, :url => simple_forum_forum_topic_posts_path(@forum, @topic), :as => :post, :html => {:id => 'new_post_form'} do |f| -%>
            <p>
              <%= f.label :body %>
              <%= f.text_area :body %>
            </p>

            <p>
              <%= f.submit %>
            </p>
        <% end %>
    <% else %>
        <%= t('.you_have_to_be_signed_in_to_create_post', :default => 'You have to be signed in to create posts') %>
        .
    <% end %>
<% else %>
    <p>
      Topic is closed!
    </p>
<% end %>
