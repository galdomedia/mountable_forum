<h1><%= @topic.title %></h1>

<table>
  <% for post in @posts do -%>
      <tr id="<%= "post-#{post.id}" %>">
        <td>
          <span class="name">
            <strong><%= post.user.login %></strong>
          </span>
          <br/>
          <span class="postdetails">
            Dołączył:
            <%= l post.user.created_at.to_date %>
            <br/>
            <% if post.user.respond_to?(:forum_posts_count) %>
              Posts:
                <%= number_with_delimiter post.user.forum_posts_count %>
            <% end %>
          </span>
        </td>
        <td>
          <span style="display: none;"><a name="<%= post.id %>"></a></span>
          <table>
            <tr>
              <td>
                <%= t 'simple_forum.post_age', :ago => time_ago_in_words(post.created_at), :at => l(post.created_at), :default => "Sent: %{at} / %{ago} ago" %>
              </td>
              <td>
                <% if user_authenticated? %>
                    <% if post.editable_by?(authenticated_user) %>
                        <%#= link_to "Edit", edit_simple_forum_forum_topic_post_path(@forum, @topic, post) %>
                    <% end %>
                    <% if post.destroyable_by?(authenticated_user) %>
                        <%#= link_to "Usuń", simple_forum_forum_topic_post_path(@forum, @topic, post), :method => :delete, :confirm => "Are you sure?" %>
                    <% end %>
                    <% if @topic.is_open? %>
                        <%= link_to "Cite", "#", :onclick => "$('#new_post_form textarea').val('[quote=\"#{post.user.login}\"]\\n#{escape_javascript(post.body)}\\n[/quote]'); return false;" %>
                    <% end %>
                <% end %>
              </td>
            </tr>
            <tr>
              <td colspan="2">
                <div class="postbody">
                  <%= post.output %>
                </div>
              </td>
            </tr>
          </table>
        </td>
      </tr>
  <% end %>
</table>

<%= will_paginate @posts if respond_to?(:will_paginate) %>

<% if @topic.is_open? %>
    <% if user_authenticated? %>
        <%= form_for @post, :url => simple_forum_forum_topic_posts_path(@forum, @topic), :as => :post, :html => {:id => 'new_post_form'} do |f| -%>
            <p>
              <%= f.label :body %>
              <%= f.text_area :body %>
            </p>

            <p>
              <%= f.submit %>
            </p>
        <% end %>
    <% else %>
        You have to be logged in to create posts.
    <% end %>
<% else %>
    <p>
      Topic is closed!
    </p>
<% end %>
